<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/assets/favicon2.png"/>
    <title>Réglage de luminosité d'écrans Dell & Philips Hue via AHK</title>
    <link rel="stylesheet" type="text/css" href="/assets/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/fork-awesome.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js" integrity="sha512-RDQSW3KoqJMiX0L/UBgwBmH1EmRYp8LBOiLaA8rBHIy+7OGP/7Gxg8vbt8wG4ZYd29P0Fnoq6+LOytCqx3cyoQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-fTl/qcO1VgvKtOMApX2PdZzkziyr2stM65GYPLGuYMnuMm1z2JLJG6XVU7C/mR+E7xBUqCivykuhlzfqxXBXbg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" type="text/css" href="/assets/css/github-markdown.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    </head>

<body class="post-template">
  <div class="site-wrapper">
    <header class="site-header outer">
      <div class="inner">
        <nav class="site-nav">
          <div class="site-nav-left">
            <a class="site-nav-logo" href="https://magnier.io"><img src="/assets/favicon2.png" alt="Vie de Nerd"></a>
            <ul class="nav">
              <li class="nav-current"><a href="https://magnier.io/">Hello, World_</a></li>
              <li><a href="/donate/">Donate</a></li>
              <li><a href="/contact/">Contact</a></li>
            </ul>
          </div>

          <div class="site-nav-right">
            <div class="social-links">

              <a class="social-link social-link-tw" href="https://twitter.com/qsypoq" title="Twitter" target="_blank" rel="noopener">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                  <path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"></path>
                </svg>
              </a>

              <a class="social-link social-link-lk" href="https://www.linkedin.com/in/adam-magnier/" title="Linkedin" target="_blank" rel="noopener">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg>
              </a>

              <a class="social-link social-link-gh" href="https://github.com/qsypoq" title="Github" target="_blank" rel="noopener">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>
              </a>
            </div>
          </div>
        </nav>
      </div>
    </header>

    <main id="site-main" class="site-main outer">
      <div class="inner">
        <article class="post-full post no-image">
          <figure class="post-full-image">
            <img srcset="medias/miniahk.jpg 300w, medias/miniahk.jpg 600w, medias/miniahk.jpg 1000w, medias/miniahk.jpg 2000w" sizes="(max-width: 800px) 400px, (max-width: 1170px) 1170px, 2000px" src="medias/miniahk.jpg">
          </figure>
          <header class="post-full-header">
            <h1 class="post-full-title">Réglage de luminosité d'écrans Dell & Philips Hue via AHK</h1>
            <section class="post-full-meta">
              <time class="post-full-meta-date" datetime="2020-08-15">2020-08-15</time>
            </section>
            
          </header>
          <section class="post-full-content markdown-body">
            <hr/>
            <p>Dans mon setup "docké" j'utilise le clavier Logitech MX Keys sur lequel se trouve 2 boutons permettant de diminuer ou augmenter la luminosité des écrans.</p>
<p>Avant j'utilisais <a href="https://justgetflux.com/">f.lux</a> donc je ne m’étais jamais penché dessus. Mais avec le temps  je dois avouer que lorsqu'on travail sur des photos, logos ou autre, la teinte donnée à l'écran par flux peut devenir très dérangeante.</p>
<p><img alt="" src="medias/f.lux-before-and-after-1.jpg" /></p>
<p>J'avais donc mon échappatoire, pouvoir diminuer la luminosité de mes écrans pour préserver mes yeux tout en gardant une palette de couleurs correcte.</p>
<p><img alt="" src="medias/giphy.gif" /></p>
<p>Utilisant déjà <a href="https://www.autohotkey.com/">AHK</a> pour mes raccourcis claviers, pourquoi ne pas chercher à y ajouter cette fonctionnalité ?</p>
<p>A noter que je n'aime pas avoir des 10ene de fichiers différents pour une même tache donc il faudra tout faire rentrer dans le script tournant en arrière plan, sans devoir appeler de .bat .vbs et autres joyeusetés.</p>
<p>Le bureau étant éclairé avec une Philips Hue, pourquoi ne pas en profiter pour la mêler à notre projet ? Une télécommande de moins dans les parages !</p>
<h2>Gestion de la luminosité des écrans</h2>
<p>Qui dit pas de raccourcis natifs dit pas de diming natif, nous devons donc trouver comment récupérer cette fonctionnalité autrement.</p>
<h3>Programmes indépendants</h3>
<p>J'ai commencé par regarder ce qui se faisait ailleurs, pas mal de programmes sont dispo mais ils ont presque tous la fâcheuse tendance à être fait de la même manière : Un soft en JS appliquant un calque noir au dessus de l'écran dont l'opacité varie pour plus ou moins l'assombrir.</p>
<p><img alt="" src="medias/electronmeme.jpg" /></p>
<p>J'ai tout de même testé. Résultat : après 5 minutes ma souris est passé au dessus du calque noir, puis des menus, puis des nouvelles fenêtres, puis crash...</p>
<h3>Dell Display Manager</h3>
<p>La bonne nouvelle ! En recherchant coté fabricants, j'ai pu découvrir que mes écrans étaient compatibles avec le logiciel Dell Display Manager, qui permet de modifier les réglages "hardware" (accessibles par les boutons physiques sur l'écran) mais via l'interface du logiciel, donc nous avons une réelle gestion matérielle de la luminosité !</p>
<p>2eme bonne nouvelle : il y a le CLI qui va avec, il est donc possible de scripter les changements sans passer par l'interface graphique, parfait pour notre objectif !</p>
<p>Aujourd’hui car je ne vais utiliser que ses fonctions de modification de luminosité, mais il est capable de plus de chose, plus d'infos sur <a href="https://www.dell.com/support/article/fr-fr/qna44541/qu-est-ce-que-dell-display-manager?lang=fr">le site de Dell</a>.</p>
<h4>Bug de luminosité</h4>
<p>Je ne sais pas si le bug vient de DDM ou du firmware de mes écrans mais le résultat est là : Si la luminosité de l'écran est fixée au minimum (0%) alors il n'est plus possible de l’incrémenter, il doit être re-set avec un pourcentage fixe.</p>
<p>Je veux une utilisation fluide, ne pas avoir à debug ou tweak chaque jour la même chose. Aller refixer à la main la luminosité après avoir trop spam n'est donc dans l'envisageable.</p>
<p>Malheureusement je n'ai pas trouvé de façon simple de récupéré le pourcentage de luminosité actuel de l'écran. Cela doit être possible en analysant les calls de DDM donc c'est envisageable pour plus tard mais c'est à exclure de notre POC.</p>
<p>Néanmoins en fouillant les clefs de registre je suis tombé sur celle-ci: <code>HKEY_CURRENT_USER\SOFTWARE\EnTech\DDM\LastRC</code></p>
<p><img alt="" src="medias/image.png" /></p>
<p>Que contient-elle ? La réponse au dernier ordre envoyé par DDM, qui est donc toujours le même lorsque l'on rencontre notre bug !</p>
<p>Ce n'est pas parfait mais on peut s'en servir, le bug arrivant lorsque notre luminosité descend à 0% ou moins, nous n'avons qu'à mettre en place un check de cette clef après chaque baisse de luminosité et le cas échant re-set la luminosité à une valeur supérieure à 0 :</p>
<pre><code class="language-autohotkey">LWin &amp; F1::
Run, %comspec% /c &quot;&quot;C:\Program Files (x86)\Dell\Dell Display Manager\ddm.exe&quot; &quot;/1:DecControl 10 A /2:DecControl 10 A&quot;&quot;, , Hide
RegRead, errorcheck, HKEY_CURRENT_USER\SOFTWARE\EnTech\DDM, LastRC
if errorcheck = 2:DecControl 10 A = Error
{
Run, %comspec% /c &quot;&quot;C:\Program Files (x86)\Dell\Dell Display Manager\ddm.exe&quot; &quot;/SetBrightnessLevel 1&quot;&quot;, , Hide
MsgBox, Minimal Brightness
}
Return
</code></pre>
<p>Voilà comment se déroule le bloc :</p>
<p>Lors de l'input <code>touche windows gauche &amp; F1</code> on demande à DDM de baisser la luminosité de 10%, puis on check le registre pour voir si nous sommes en erreur (et donc à &lt;= 0). Si c'est le cas on set la luminosité à 1% puis on l'indique dans un pop-up afin de ne pas spammer inutilement le raccourci.</p>
<p><strong>Update: Le workaround</strong> <code>RegRead</code> <strong>ne fonctionne pas à 100% et une grand partie des erreurs ne sont pas vues, j'ai finalement réécris moi-même une fonction de gestion de l'incrémentation :</strong></p>
<ul>
<li>On définit une variable DellBri fixé à 70 (pour 70%) au démarrage</li>
<li>A chaque augmentation ou diminution, on vient faire -10 ou +10 puis on passe la commande qui force-set un niveau de luminosité, avec la variable comme argument.</li>
</ul>
<p>Voilà ce que ça donne :</p>
<pre><code class="language-autohotkey">DellBri := 70

LWin &amp; F1::
DellBri -= 10
if DellBri &lt;= 0
{
    DellBri = 0
    Run, %comspec% /c &quot;&quot;C:\Program Files (x86)\Dell\Dell Display Manager\ddm.exe&quot; &quot;/SetBrightnessLevel 0&quot;&quot;, , Hide
}
else {
    Run, %comspec% /c &quot;&quot;C:\Program Files (x86)\Dell\Dell Display Manager\ddm.exe&quot; &quot;/SetBrightnessLevel %DellBri%&quot;&quot;, , Hide
}
Return
</code></pre>
<p>J'ai ajouté la condition &lt;= 0 ainsi si l'utilisateur spam le bouton pour diminuer la luminosité il ne doit pas spammer autant de fois l'augmentation pour augmenter d'un cran.</p>
<p>Bonus: Lorsque l'on utilisait la fonction de palier native les écrans avait un delais de quelque chose comme 0.25s, ils ne changeaient pas de luminosité en même temps. Alors qu'avec le SetBrightnessLevel ils sont synchronisés !</p>
<h2>Gestion de la luminosité de la pièce</h2>
<h3>Philips Hue &amp; API</h3>
<p>TLDR: Les lampes Philips Hue disposent d'une API, limitée comparée à leurs possibilités globales mais répondant à 100% à mon besoin. De plus leur documentation est très intuitive donc je ne vais pas les paraphraser, elle est <a href="https://developers.meethue.com/develop/get-started-2/">disponible ici</a>.</p>
<p>Le debugger permet de jouer et tester à la main pas mal de choses, voici donc les fonctionnalités qui m’intéressent:</p>
<ul>
<li>Allumer/Éteindre l'ampoule</li>
</ul>
<pre><code class="language-autohotkey">Method = &quot;PUT&quot;
URL = &quot;$ip_bridge/api/$userID/lights/$lampID/state&quot;
Body = {&quot;on&quot;:true/false}
</code></pre>
<ul>
<li>Changer la luminosité</li>
</ul>
<pre><code class="language-autohotkey">Method = &quot;PUT&quot;
URL = &quot;$ip_bridge/api/$userID/lights/$lampID/state&quot;
Body = {&quot;bri&quot;:1-255}
</code></pre>
<p>Maintenant il faut faire rentrer ça dans AHK !</p>
<p>Nous allons donc utiliser un objet WinHttpRequest, plus d'informations sur <a href="https://docs.microsoft.com/en-us/windows/win32/winhttp/winhttprequest">la doc officielle de Microsoft</a>.</p>
<p>Voici donc à quoi ressemble une requête pour allumer une ampoule :</p>
<pre><code class="language-autohotkey">LWin &amp; F4::
TurnOn := ComObjCreate(&quot;WinHttp.WinHttpRequest.5.1&quot;)
TurnOn.Open(&quot;PUT&quot;, &quot;http://$bridgeIP/api/$userID/lights/$lampID/state&quot;, 0)
body = {&quot;on&quot;:true}
TurnOn.Send(body)
Return
</code></pre>
<p>De même, pour changer la luminosité, il faut passer la valeur voulue au parametre <code>bri</code> comme vu plus haut, à noter que nous pouvons en faire passer plusieurs à la fois. Pour, par exemple, allumer l'ampoule et la set à 255/255 en une seule requete :<code>body = {"on":true, "bri":255}</code></p>
<h4>Récupérer des valeurs</h4>
<p>Contrairement aux écrans nous ne pouvons pas incrémenter l'intensité des ampoules nativement, nous allons donc avoir besoin de la valeur à un instant T de <code>bri</code> afin de créer nous même l’incrémentation.</p>
<p>Grace à l'API nous pouvons récolter tout un tas d'infos sur les valeurs actuelles concernant notre ampoule, voici un aperçu :</p>
<p><img alt="" src="medias/image-1.png" /></p>
<p>Ce qui nous intéresse ici c'est donc la valeur de <code>bri</code>, une fois les infos récupérées dans AHK nous pouvons extraire la valeur grâce à une fonction créée sur mesure (on évite au passage de devoir sortir unRegExp) :</p>
<pre><code class="language-autohotkey">LWin &amp; F4::
GetBri := ComObjCreate(&quot;WinHttp.WinHttpRequest.5.1&quot;)
GetBri.Open(&quot;GET&quot;, &quot;http://10.0.0.15/api/wABz--1bvJ5mkwjc3yRjLTjzUMtz8qD5BvL1LLho/lights/3/&quot;, 0)
GetBri.Send()
FullResponse := GetBri.ResponseText
start = bri&quot;:
end = ,&quot;hue&quot;
ActualBri := StringBetween( FullResponse, start, end )

StringBetween( String, NeedleStart, NeedleEnd=&quot;&quot; ) {
    StringGetPos, pos, String, % NeedleStart
    If ( ErrorLevel )
         Return &quot;&quot;

    StringTrimLeft, String, String, pos + StrLen( NeedleStart )

    If ( NeedleEnd = &quot;&quot; )
        Return String

    StringGetPos, pos, String, % NeedleEnd

    If ( ErrorLevel )
        Return &quot;&quot;

    StringLeft, String, String, pos

    Return String
}

MsgBox, % ActualBri
Return
</code></pre>
<p>Grace à cette fonction nous pouvons choisir 2 chaines de caractères entourant les valeurs que nous souhaitons récupérer, merci les forums AHK !</p>
<p><img alt="" src="medias/image-2.png" /></p>
<h4>Bonus : Amplitude horaire</h4>
<p>Selon l’éclairage / les reflets nous pouvons vouloir augmenter ou diminuer la luminosité de nos écrans sans pour autant avoir besoin que la lumière soit allumée.</p>
<p>Pour cela nous pouvons mettre une condition horaire sur l'interaction avec les lampes :</p>
<p><code>FormatTime, TimeString, hh, Time</code> Permet de recuperer l'heure au format hh:mm<code>ActualTime := SubStr(TimeString, 1, 2)</code> Afin de ne garder que les 2 premiers chiffresIl ne reste qu'à mettre l'amplitude horaire comme condition à nos requetes :</p>
<pre><code class="language-autohotkey">if ActualTime between 8 and 17
{
    requete
}
</code></pre>
<p>Pas plus compliqué que ça !</p>
<p>Maintenant que nous savons récupérer et set des valeurs on peut partir sur la dernière ligne droite, agencer tout ça !</p>
<h2>Combinaison des différents éléments</h2>
<p>Il faut qu'à l'allumage de l'ordinateur les valeurs de base de l’écran et des ampoules soient constantes et en harmonie. Ainsi pas de déséquilibre entre l'intensité de la lumière et celle des écrans.</p>
<p>Pour cela nous allons donc set une valeur fixe qui sera appliquée à chaque démarrage du script (et donc de l'ordinateur). Je vais partir sur la base de 70% d'intensité :</p>
<pre><code class="language-autohotkey">Run, %comspec% /c &quot;&quot;C:\Program Files (x86)\Dell\Dell Display Manager\ddm.exe&quot; &quot;/SetBrightnessLevel 70&quot;&quot;, , Hide
DellBri := 70

FormatTime, TimeString, hh, Time
ActualTime := SubStr(TimeString, 1, 2)
if ActualTime between 8 and 15
{
    LampOn := &quot;false&quot;
}
else
{
    LampOn := &quot;true&quot;
}
Boot := ComObjCreate(&quot;WinHttp.WinHttpRequest.5.1&quot;)
Boot.Open(&quot;PUT&quot;, &quot;http://$bridgeIP/api/$userID/lights/$lampID/state&quot;, 0)
body = {&quot;on&quot;:%LampOn%, &quot;bri&quot;:178}
Boot.Send(body)
</code></pre>
<p>Il faudra jongler entre les valeurs Dell et les valeurs Hue, le 1er étant exprimé en pourcentage, le deuxième en nombre binaire à huit chiffres. Ces derniers ne pouvant comporter de virgule on va arrondir (ici 70% de 255 = 178.5, on utilise 178)</p>
<p>On définit selon l'heure la variable d’état de l'ampoule, ainsi, même si elle est éteinte, la luminosité correspondante qui reviendra lorsque l'heure sera la bonne sera toujours en corrélation avec celle de l'écran !</p>
<p>Ensuite on déclare la fonction permettant de chercher dans les retours d'API :</p>
<pre><code class="language-autohotkey">StringBetween( String, NeedleStart, NeedleEnd=&quot;&quot; ) {
    StringGetPos, pos, String, % NeedleStart
    If ( ErrorLevel )
         Return &quot;&quot;
    StringTrimLeft, String, String, pos + StrLen( NeedleStart )
    If ( NeedleEnd = &quot;&quot; )
        Return String
    StringGetPos, pos, String, % NeedleEnd
    If ( ErrorLevel )
        Return &quot;&quot;
    StringLeft, String, String, pos
    Return String
}
</code></pre>
<p>Passons au premier bind, celui pour diminuer l'intensité :</p>
<pre><code class="language-autohotkey">LWin &amp; F1::
DellBri -= 10
FormatTime, TimeString, hh, Time
ActualTime := SubStr(TimeString, 1, 2)
if ActualTime between 8 and 15
{
    LampOn := &quot;false&quot;
}
else
{
    LampOn := &quot;true&quot;
}
if DellBri &lt;= 0
{
    DellBri = 0
    Run, %comspec% /c &quot;&quot;C:\Program Files (x86)\Dell\Dell Display Manager\ddm.exe&quot; &quot;/SetBrightnessLevel 0&quot;&quot;, , Hide
    SendBri := ComObjCreate(&quot;WinHttp.WinHttpRequest.5.1&quot;)
    SendBri.Open(&quot;PUT&quot;, &quot;http://$briddeIP/api/$userID/lights/$lampID/state&quot;, 0)
    body = {&quot;on&quot;:%LampOn%, &quot;bri&quot;:0}
    SendBri.Send(body)
}
else
{
    Run, %comspec% /c &quot;&quot;C:\Program Files (x86)\Dell\Dell Display Manager\ddm.exe&quot; &quot;/SetBrightnessLevel %DellBri%&quot;&quot;, , Hide
    GetBri := ComObjCreate(&quot;WinHttp.WinHttpRequest.5.1&quot;)
    GetBri.Open(&quot;GET&quot;, &quot;http://$briddeIP/api/$userID/lights/$lampID/&quot;, 0)
    GetBri.Send()
    FullResponse := GetBri.ResponseText
    start = bri&quot;:
    end = ,&quot;hue&quot;
    ActualBri := StringBetween( FullResponse, start, end )
    NewBri := ActualBri - 25
    SendBri := ComObjCreate(&quot;WinHttp.WinHttpRequest.5.1&quot;)
    SendBri.Open(&quot;PUT&quot;, &quot;http://$briddeIP/api/$userID/lights/$lampID/state&quot;, 0)
    body = {&quot;on&quot;:%LampOn%, &quot;bri&quot;:%NewBri%}
    SendBri.Send(body)
}
Return
</code></pre>
<p>Comme vu précédemment nous faisons attention à la possibilité que l'utilisateur spam la touche, nous définissions donc les valeurs minimales et maximales pour éviter de devoir re-spammer dans l'autre sens.</p>
<p>J'ai pris comme palier le choix arbitraire de 10%, (soit environs 25 pour notre octet) car je n'ai pas envie de passer un temps interminable pour aller d'un extrême à l'autre.</p>
<p>Pour l'augmentation :</p>
<pre><code class="language-autohotkey">LWin &amp; F2::
DellBri += 10
FormatTime, TimeString, hh, Time
ActualTime := SubStr(TimeString, 1, 2)
if ActualTime between 8 and 15
{
    LampOn := &quot;false&quot;
}
else
{
    LampOn := &quot;true&quot;
}
if DellBri &gt;= 100
{
    DellBri = 100
    Run, %comspec% /c &quot;&quot;C:\Program Files (x86)\Dell\Dell Display Manager\ddm.exe&quot; &quot;/SetBrightnessLevel 100&quot;&quot;, , Hide
    SendBri := ComObjCreate(&quot;WinHttp.WinHttpRequest.5.1&quot;)
    SendBri.Open(&quot;PUT&quot;, &quot;http://$bridgeIP/api/$userID/lights/$lampID/state&quot;, 0)
    body = {&quot;on&quot;:%LampOn%, &quot;bri&quot;:255}
    SendBri.Send(body)
}
else
{
    Run, %comspec% /c &quot;&quot;C:\Program Files (x86)\Dell\Dell Display Manager\ddm.exe&quot; &quot;/SetBrightnessLevel %DellBri%&quot;&quot;, , Hide
    GetBri := ComObjCreate(&quot;WinHttp.WinHttpRequest.5.1&quot;)
GetBri.Open(&quot;GET&quot;, &quot;http://$bridgeIP/api/$userID/lights/$lampID/&quot;, 0)
    GetBri.Send()
    FullResponse := GetBri.ResponseText
    start = bri&quot;:
    end = ,&quot;hue&quot;
    ActualBri := StringBetween( FullResponse, start, end )
    NewBri := ActualBri + 25
    SendBri := ComObjCreate(&quot;WinHttp.WinHttpRequest.5.1&quot;)
SendBri.Open(&quot;PUT&quot;, &quot;http://$bridgeIP/api/$userID/lights/$lampID/state&quot;, 0)
    body = {&quot;on&quot;:%LampOn%, &quot;bri&quot;:%NewBri%}
    SendBri.Send(body)
}
Return
</code></pre>
<p>Nous retrouvons la même chose, mais cette fois si avec 100 &amp; 255 comme valeurs maximales.</p>
<p>Avant de se quitter, une démo vidéo :</p>
<video controls width="840">

    <source src="medias/ahk-ddm-hue.mp4"
            type="video/mp4">

    Sorry, your browser doesn't support embedded videos.
</video>

<p>Le fichier final est disponible <a href="https://github.com/qsypoq/AHK-Dell-Display-Manager-Philips-Hue/blob/master/script.ahk">sur mon github</a>, n’hésitez pas à proposer vos améliorations !</p>
          </section>

          <footer class="post-full-footer">
            <section class="author-card">
              <img class="author-profile-image" src="//www.gravatar.com/avatar/8952a5bcfd493bf24e7c8af50f6a28da?s=250&amp;d=mm&amp;r=x" alt="Adam 'Qsypoq' Magnier">
                <section class="author-card-content">
                  <h4 class="author-card-name"><a href="/">Adam 'Qsypoq' Magnier</a></h4>
                  <p>Read <a href="/">more posts</a> by this author.</p>
                </section>
            </section>
          </footer>
        </article>
      </div>
    </main>
  </div>

  <footer class="site-footer outer">
    <div class="site-footer-content inner">
      <section class="copyright"><a href="https://magnier.io"><img src="/assets/favicon.png" alt="Vie de Nerd" width="32" height="32"></a></section>
      <nav class="site-footer-nav">
        Powered by Persifleur <i style="color:#c0392b;" class="fa fa-heart"></i> <a href="https://magnier.io/mentions-legales">Mentions légales</a>.
      </nav>
    </div>
  </footer>
</body>
</html>